# Лабораторная 1 - Анекдотический чат-бот

## Задача:

Создать чат-бот для телеграмма/дискорда/вк/чего-либо с функционалом выдачи анекдотов. Чат-бот так же должен иметь HTTP-интерфейс для добавления/изменения/удаления/просмотра анекдотов.

## Функциональные требования:

То, что хочет клиент.

1. Чат-бот, выдающий анекдоты по запросу (команде, кнопке, сообщению)
2. HTTP интерфейс с работой через JSON:
- GET /jokes - выдача всех шуток
- GET /jokes/id - выдача шутки с определенном ID
- POST /jokes - создание новой шутки
- PUT /jokes/id - изменение шутки
- DELETE /jokes/id - удаление шутки

## Нефункциональные требования

Технологическая часть

1. Система сборки - Maven или Gradle
2. Java - 17 или 21 версии
3. Spring Boot - 3.2.3+
4. Язык - Java
5. Модель(сущность) шутки должна в себе содержать - идентификатор(id), сам текст шутки, дата создания, дата обновления
6. Методы:
- GET /jokes - не принимает никаких параметров, выдает список шуток по модели
- GET /jokes/id - принимает id как параметр пути, выдает шутку с данным id или же 404 если ничего не нашлось
- POST /jokes - принимает JSON шутки в Body. Устанавливает дату создания.
- PUT /jokes/id - принимает id как параметр пути, изменяет шутку с данным id. Поле id в Body - игнорируется. Устанавливает дату обновления.
- DELETE /jokes/id - удаляет шутку с данным ID
7. Хранение - H2 Database в файле (можно и Postgres, если знаете как)
8. Выдача анекдота: по кнопке, команде, сообщения (зависит от платформы чат-бота)

## Больше подробностей

### Полезные ссылки:

- Приложение с 1 лекции: https://github.com/pasvitas-sensei/spring-lesson-one
- Приложение со 2 лекции: https://github.com/pasvitas-sensei/spring-lesson-two
- Overview: https://spring.io/projects/spring-boot
- Генератор: https://start.spring.io
- Учебники и гайды: https://www.baeldung.com/start-here
- Гайды на русском: https://spring-projects.ru/guides/
- Вводная статья: https://habr.com/ru/articles/435144/
- Большой туториал: https://proselyte.net/tutorials/spring-tutorial-full-version/

### Подсказки по генерации проекта:

1. Дайте artifactId, groupId и Description осмысленные имена. GroupId начинается с обратного домена, то есть вместо projects.yournick.ru должно быть ru.yournick.projects. ArtifcatId - лучше разделять слова тире your-awesome-project
2. Зависимости и настройки, которые вам понадобятся:
   ![start-spring-io.png](start-spring-io.png)
3. Описание зависимостей:
- Lombok - позволяет устранить бойлер-код за счет аннотаций (@RequredArgsConstructor, Data, Getter, Setter и тп)
- Spring Web - веб сервер для HTTP-запросов
- Spring Data JPA - ORM фреймворк для работы с базой данных
- H2 - драйвер базы H2 для работы с ней

### Подсказки по написанию проекта:

1. Оставьте чат-бота на потом, так как он всего лишь еще один "вывод" из проекта, такой же, как и HTTP-методы. А еще внизу есть уже готовые.
2. H2 - встроенная база данных, которая работает пока ваше приложение запущено. Можно сохранять в файл. Подключение ко всем БД не сложнее, чем подключение к H2, но для начала можно использовать её. Строчки конфига для application.yaml:
```yaml
spring:
  datasource:
    driver-class-name: org.h2.Driver # Драйвер для подключения к базе данных
    url: jdbc:h2:file:./db # Само подключение в формате jdbc:{название драйвера}:{тип хранения}:{путь}. В данном случае сохранится в файл db.mv.db в корне проекта
    username: sa # Имя пользователя, стандартное
    password: # Пользователь без пароля
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect # Диалект, чтобы JPA знала, как ей общаться с БД
    hibernate:
      dll-auto: update # Создать схему и обновить при необходимости. Временное решение для тествых проектов
```
Или тоже самое, если вам удобнее в properties:
```properties
# Драйвер для подключения к базе данных
spring.datasource.driver-class-name=org.h2.Driver
# Само подключение в формате jdbc:{название драйвера}:{тип хранения}:{путь}. В данном случае сохранится в файл db.mv.db в корне проекта
spring.datasource.url=jdbc:h2:file:./db
# Имя пользователя, стандартное
spring.datasource.username=sa
# Пользователь без пароля
spring.datasource.password=
# Диалект, чтобы JPA знала, как ей общаться с БД
spring.jpa.database-platform= org.hibernate.dialect.H2Dialect
# Создать схему и обновить при необходимости. Временное решение для тествых проектов
spring.jpa.hibernate.ddl-auto=update
```
3. Постарайтесь сделать следующую структуру пакетов в вашем приложении:
- Config: Там будет содержаться конфигурация подключения к боту
- Service: Основная бизнес-логика, хорошо будет смотрется связка Interface -> Implementation. Сюда же сервис бота
- Model: Основная сущность вашего приложения.
- Repository: Работа с базой данных
4. Любые токены от ботов не должны быть забиты в коде, они должны браться из application.yml/application.properties через @Value(${}). Но и там они не должны быть забиты, так как могут попасть в Git. У Idea есть механизм перезаписи конфиг-значений при записи.
- Открываете настройки конфигурации(Edit Configuration), в выпадающем меню сверху справа
  ![config-1.png](config-1.png)
- Справа от Build and Run -> Modify Options и галочку на Override Configuration Properties
  ![config-2.png](config-2.png)
- Добавляете свои параметры в появившуюся табличку в формате ключ-значение. Вы бесподобны!
  ![config-3.png](config-3.png)
5. Lombok и Hibernate(библиотека, которая отвечает за преобразование данных из БД в классы) не то чтобы лучшие друзья, но и не враги. Тем не менее, если эта связь начинает себя странно вести - заменяйте в сущностях аннотации Lombok на стандартные геттеры/сеттеры/конструкторы (в IDEA есть функция для их генерации). Или на другие аннотации ломбока:
```Java
@Getter
@Setter
@ToString
```

### Чат-бот

Эта часть уже посвящена написанию чат бота, так как это отдельная задача. Я рекомендую писать их для Telegram/Discord, как для самых простых платформ.

Эти библиотеки вам могут помочь:
- Telegram: https://github.com/rubenlagus/TelegramBots
- Discord: https://github.com/discord-jda/JDA

Вы можете попытаться сделать чат-бота сами с помощью документации или использовать уже мои готовые заготовки:
- Telegram: https://gist.github.com/pasvitas/83829b60410802b2bbd08ae27b11fd8c
- Discord: https://gist.github.com/pasvitas/44dd278572d4e584b26910378ff42848

Или можете совместить два подхода, попытаться сделать сами, а в случае затруднения - обратиться к ним, тут все с комментариями.

### Сдача

Сдача проекта через Git-репозиторий на Github/Gitlab. Если не умеете - напомните, я дам лекцию о том, как с ним работать. Защищать не обязательно, но если хотите проверить, все ли вы усвоили и поняли - можно.
WARNING. Убедитесь, что когда коммитите в гит - не оставили в коде никаких токенов для ботов.